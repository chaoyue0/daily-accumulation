# 性能优化
从过程趋势来看，性能优化可以分为`网络层面`和`渲染层面`；从结果趋势来看，性能优化可分为`时间层面`和`体积层面`

## 网路层面
### 构建策略
主要围绕webpack做相关处理
#### 减少打包时间
##### 缩减范围
配置`include/exclude`缩小Loader对文件的搜索范围，可以避免不必要的编译
##### 缓存副本
配置`cache`缓存，加快构建速度
```
 cache: {
      type: 'filesystem',
      allowCollectingMemory: true,
    },
```
##### 定向搜索
配置`resolve`提高文件的搜索速度,alias映射模板路径，extensions表明文件后缀
##### 并行构建
配置`Thread`将Loader单进程转换为多进程，释放CPU多核并发的优势

使用thread-loader开启多线程
##### 可视结构
配置`BundleAnalyzer`分析打包文件结构，直观分析打包文件的模块组成部分、模块体积占比、模块包含关系、模块依赖关系、文件是否重复、压缩体积对比等可视化数据

#### 减少打包体积
##### 分割代码
将一个大的js文件分割成多个较小的代码块，将公共的代码抽离成单独的chunk，避免资源重复打包，
在需要的时候按需加载 ，并充分利用浏览器的缓存机制，缩短资源加载时间

- module：应用程序的一个单独的模块，webpack将每一个模块视为一个独立的单元，并通过识别模块之间的依赖关系来构建应用程序
- chunk：一组相互依赖的module，组合在一起即可并行加载，浏览器可同时加载多个chunk而不是一个大文件
- bundle：包含一个或多个chunk和其他资源文件

        module、chunk、bundle其实是同一份代码在不同转换场景的三种webpack术语，源文件是module，webpack处理时是chunk，浏览器可以直接运行的是bundle
###### 移除重复的代码块
使用 splitChunks 的 `cacheGroups` 配置：

- reuseExistingChunk属性重用模块，而不是重新生成
- enforce：表示是否强制拆分

###### 将PNPM包拆分为体积适中的chunk
vue cli默认的webpack配置已经完成了此项配置，移除了node_module包中的重复模块
##### 摇树优化
##### 动态垫片
##### 按需加载
##### 作用提升
##### 压缩资源
###### html压缩
html-wepack-plugin插件，可以压缩html

###### css压缩
optimize-css-assets-webpack-plugin插件，可以压缩css

    如果要在开发环境也进行css压缩，需要将minimize配置属性设为true

###### js压缩
terser-webpack-plugin插件，可以压缩js

    在webpack v5中是开箱即用的，如果需要自定义配置的话需要引入该插件


### 图像策略
### 分发策略
### 缓存策略

## 优化标准
目的：希望降低程序的`整体开销`，应该把重点放在对程序`整体开销影响最大`的那部分上

原则：评估优先，拒绝任何不能提供良好效益的优化，浏览器通常在运行js上花费的时间很少，绝大部分时间消耗在DOM上

### 性能指标轴线

- 低效线：会降低用户的关注度，并使用户烦躁不安
- 受挫线：用户会意识到自己在被迫等待，导致用户开始考虑其他事情
- 失败线：由于应用崩溃或浏览器产生一个对话框告诉用户应用失败，用户只能刷新或关闭浏览器

### 性能指标时间点
如何才算“足够快”

- 0.1秒：用户直接操作UI中对象的感觉极限
- 1秒：用户随意地在计算机指令空间进行操作而无需过度等待地感觉极限，超过1秒地延时要提示用户计算机正在处理问题，例如loading
- 10秒：用户专注于任务的极限，需要一个百分比完成指示器，以及一个方便用户中断操作的方法

### 测试原则
测试用户环境，使用低端机器和低速网络来测试，在开发人员的高配置环境中得出的测试结果还可能会掩盖性能问题

### 测试延时时间

- 手动代码检查：代码中添加`计时器`记录函数的`执行时间`
- 自动代码检测：通过`工具`进行`性能分析`，查找瓶颈或运行最慢的代码块


    工具：Firefox插件Firebug包含一个js代码性能分析器（已下架）

## 无阻塞加载脚本
背景：script标签的阻塞行为会对页面性能产生负面影响，加载脚本的同时不会下载其他内容

下载和执行脚本出现阻塞的原因：脚本可能会改变页面或js的命名空间，会对后续内容造成影响

    脚本必须按顺序执行，但没必要按顺序下载

## webpack打包速度优化

### 方案
缓存、多进程、抽离、拆分

### 