# 编译模块
Vue的编译分为三个阶段，即解析(Parse)、转换(Transform)和代码生成(Codegen)

- 解析阶段：将`模板字符串`转换为`抽象语法树`(AST)
- 转换阶段：对AST做一些转换处理
- 代码生成阶段：根据AST生成相应的`render渲染函数`

## Parse 解析阶段
在模板解析过程中，解析器会根据一定的规则来将模板字符串进行分隔，具体的分割逻辑：

- 标签分隔：根据 < 和 > 来识别标签，遇到左尖括号识别这是一个标签的开始，会一直解析遇到右尖括号为止
- 插值分隔：根据 {{ 和 }} 来识别插值表达式
- 空白字符分隔：包括空格、换行符等
- 特定标记分隔：如 <!-- 和 --> 注释的起始和结束标记

分析模板字符串时，主要分为两种情况：以’<'开头的字符串、不是以'<'开头的字符串

### 以’<'开头的字符串

- 元素开始标签
- 元素结束标签
- 注释节点
- 文件声明

### 不以’<'开头的字符串

- 文本节点
- 插入表达式

### baseParse 入口函数
定义：接收一个模板字符串作为参数，在函数中会初始化一些状态和变量，调用parse函数来进行实际的解析过程

#### createParserContext
定义：创建一个`解析器上下文对象`，这个对象将会在解析模板字符串的过程中保存一些`状态和选项`，比如当前解析的行数、列数、字符串偏移量等

1、创建解析器上下文对象

2、遍历传入的原始选项，将默认选项和传入的原始选项进行合并

3、返回解析器上下文对象，它包含了解析过程中的状态和选项

#### 获取起始的光标位置
1、从解析器上下文中获取`列号、行号、字符偏移量`

2、返回包含光标位置信息的`对象`
#### 生成AST的根节点
##### parseChildren 解析子节点
定义：该函数负责在解析过程中遍历模板字符串，根据`不同的子节点类型`进行相应的解析，并将解析得到的子节点存储在一个数组中返回

步骤：

1、获取父元素：通过ancestors数组获取解析的父元素节点，并跟踪当前解析的嵌套层级

2、确定命名空间：根据父元素的命名空间，决定当前节点的命名空间

3、初始化节点数组：存储解析的子节点

4、循环解析子节点：不断解析模板的各种子节点，直到遇到结束标记

5、解析不同类型的子节点：文本节点、标签节点、注释节点、插值表达式节点、其他情况节点

6、将解析的节点添加到数组node
##### getSelection 获取解析的范围
定义：用于根据起始和结束的`光标位置信息`，生成一个源代码范围`对象`，包含范围的起始位置、结束位置、范围内的源代码

    光标位置信息：代码或文本中某个特定位置的位置描述，包含列号、行号、字符偏移量三个属性，确定了字符串的具体位置

### Parser 类