## Browser
### https和http的区别

https在http的基础上增加SSL组成了以安全为目标的http通道；

#### 加密方式
- 对称加密

使用同一个密钥来进行加密和解密，就是通信双方使用同一个密钥，一方加密发送信息，一方解密获取信息；

步骤：

1、A通信方将密钥发送给B通信方

2、B通信方使用密钥将信息加密后发送给A

3、A使用密钥解密B发送过来的加密信息
- 非对称加密

通过一个公钥进行加密，然后通过私钥进行解密；

步骤：

1、A将自己的公钥发送给B；

2、B将自己的公钥发送给A；

3、B使用A的公钥加密信息发送给A；

4、A使用自己的私钥进行解密信息，得到原始信息；

5、A使用B的公钥加密信息发送给B；

6、B使用自己的私钥进行解密信息，得到原始信息；

#### HTTPS加密方式

采用非对称+对称组合加密；传输数据的加密方式采用对称加密，对`对称密钥`的传输采用非对称加密；

步骤：

1、A将自己的公钥发送给B；

2、B将自己的公钥发送给A；

3、B生成随机对称密钥并使用A的公钥加密信息发送给A；

4、A使用自己的私钥解密信息，得到`对称密钥`；(非对称加密使用私钥解密得到原始信息)

5、双方通过后，使用对称密钥进行通信；

### 状态码
#### 304 协商缓存
定义：当客户端发送带有缓存验证信息的请求时，服务器可以通过返回304表示请求的资源未发送改变，
客户端可以继续使用缓存的版本，无需重新下载资源；

工作原理：

1、客户端发送带有缓存验证信息的请求给服务器；(If-Modified-Since和If-None-Match)；

2、服务器收到请求后，检查缓存验证信息和资源上的验证信息是否匹配；(缓存验证信息确实没有改变，但是服务器资源发送了改变，导致不匹配)

3、如果服务器发现资源自上次请求以来没有变化，则返回304；

4、客户端收到304响应后，就会使用本地的缓存信息，而不是重新下载资源；


#### 401和403
##### 401
标示`认证`失败，通过由服务器返回，而不是客户端，常用场景为token失效导致服务器无法识别身份

##### 403
标示`授权`失败，标示用户通过了身份认证，但是缺少权限对给定的资源进行访问和操作，通过客户端返回，常用
场景为用户登录成功，但是无权限进行读写操作

##### 区别
- 401侧重于认证，403侧重于授权
- 401由服务器返回，403由客户端返回
- 401标示用户未通过身份授权，403标示通过了身份授权但缺少指定权限

### HTTP缓存

定义：一种保存资源副本并在下次请求时直接使用该副本的技术

作用：减少网络请求数量和体积，加快页面的加载

不能缓存资源：html和业务数据

#### 强缓存

定义：直接从本地缓存中获取，不需要发起请求

步骤：

1、初次请求：浏览器向服务器发起请求，服务器收到请求后，返回资源并返回一个Cache-Control字段给浏览器

2、再次请求：检查Cache-Control字段是否过期，没有过期则直接从本地缓存中拉取资源返回给浏览器，不需要经过服务器

Cache-Control字段：（response header）

- max-age：设置最大缓存时间
- no-cache：不用本地缓存，正常向服务器请求
- no-store：直接从服务器拉取缓存
- private：只允许最终用户做缓存，即电脑、手机
- public：允许中间路由、中间代理做缓存

#### 协商缓存

定义：一种服务端的缓存策略，即通过服务器判断客户端的资源是否和服务端资源一样，一致则返回304，反之则返回200和最新的资源

步骤：

1、初次请求，服务器返回资源和`资源标示`（Last-Modified或者E-tag）

2、再次请求，带着`资源标示`（If-Modified-Since或If-None-Match）

3、服务器返回状态码

### 断网处理

#### js监听网络状态

##### navigator.onLine
用于检测浏览器是否联网，true表示online，false表示offline 

##### navigator.connection
用于检测网络状况，判断当前网络流畅、拥堵、繁忙，属性包含effectiveType、rtt、downlink

- effectiveType：4g、3g、2g、4g(rtt、downlink均为0)，分别表示online、fast 3g、slow 3g和offline
- rtt：连接预估往返时间，单位是ms，值越小网速越快
- downlink：带宽预估值，单位是Mbit/s，值越大(可传输的数量越多)网速越快

##### change 事件
用于监听网速变化并作出响应处理的事件

    const connection = navigator.connection；
    connection.addEventListener('change', updateConnectionStatus);

##### offline和online 事件
分别用于监听断网和联网情况并作出相应处理

    window.addEventListener('online',  updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);

##### 页面重载
网络关闭时需要在offline事件中提示用户，网络重连后，可以在online事件中重新加载当前页面

    location.reload()

#### WebSocket心跳及重连机制
心跳机制：每隔一段时间向服务器发送一个数据包，告诉服务器自己还活着；服务器回传一个数据包给客户端，告诉客户端自己还活着，如果没有则有可能是网络断开连接了

重连机制：`onmessage事件`能监听到的话，说明请求正常，使用了一个`定时器`，每隔3秒的情况下，如果是网络断开的情况下，在指定的时间内服务器端并没有返回心跳响应消息，因此服务器端断开了，
我们使用`ws.close关闭连接`，在一段时间后可以通过`onclose事件`监听到。因此在onclose事件内，我们可以调用`reconnect事件`进行重连操作。

##### WebSocket 与 HTTP的区别

- WebSocket持久连接，http是短链接
- WebSocket协议以ws/wss开头，http以http/https
- WebSocket是有状态的，http是无状态的
- WebSocket建立连接后客户端和服务器可以双向发送消息，http只能客户端发起请求，服务器返回数据
- WebSocket可以跨域
- WebSocket建立连接后，数据的传输使用帧来传输，不需要request消息